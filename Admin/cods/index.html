<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<title>Ø¥Ø¯Ø§Ø±Ø© Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<style>
/* Ù†ÙØ³ Ø§Ù„Ø§Ø³ØªØ§ÙŠÙ„ Ø¨ØªØ§Ø¹Ùƒ ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§ */
:root {
  --primary: #007AFF;
  --primary-light: #5AC8FA;
  --secondary: #5856D6;
  --success: #34C759;
  --danger: #FF3B30;
  --warning: #FF9500;
  --dark: #1C1C1E;
  --light: #F2F2F7;
  --gray: #8E8E93;
  --card-bg: #FFFFFF;
  --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  --radius: 14px;
  --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
}

body{
  font-family:Tajawal;
  background:#F2F2F7;
}

.container{
  max-width:1200px;
  margin:auto;
  padding:20px;
}

header{
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  color:white;
  padding:25px;
  border-radius:var(--radius);
  text-align:center;
  margin-bottom:25px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:20px;
}

.card{
  background:white;
  padding:20px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
}

.code-row{
  background:#f2f2f7;
  padding:10px;
  margin:8px 0;
  border-radius:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.btn{
  padding:8px 12px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

.btn-primary{background:var(--primary);color:white;}
.btn-danger{background:var(--danger);color:white;}
.btn-success{background:var(--success);color:white;}

.codes-box{
  margin-top:10px;
}

input{
  width:100%;
  padding:10px;
  margin:10px 0;
}
</style>
</head>

<body>

<div class="container">
<header>
<h1><i class="fas fa-key"></i> Ø¥Ø¯Ø§Ø±Ø© Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</h1>
</header>

<div id="grid" class="grid"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { 
  getFirestore, collection, getDocs, doc, setDoc, deleteDoc
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "lectures-123.firebaseapp.com",
  projectId: "lectures-123",
  storageBucket: "lectures-123.firebasestorage.app",
  messagingSenderId: "973877461046",
  appId: "1:973877461046:web:3f592e25dc5cccc2acd897"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let lectures = [];
let codes = [];

async function fetchLectures(){
  const snap = await getDocs(collection(db,"lectures"));
  lectures = [];
  snap.forEach(d=>{
    const x = d.data();
    x.id = d.id;
    lectures.push(x);
  });
}

async function fetchCodes(){
  const snap = await getDocs(collection(db,"codes"));
  codes = [];
  snap.forEach(d=>{
    const x = d.data();
    x.id = d.id;
    codes.push(x);
  });
}

function render(){
  const grid = document.getElementById("grid");
  grid.innerHTML="";

  lectures.forEach(l=>{
    const related = codes.filter(c => c.lectureName === l.col);

    const card = document.createElement("div");
    card.className="card";

    card.innerHTML = `
      <h3>ğŸ“˜ ${l.col}</h3>
      <p>Ø§Ù„ØµÙ: ${l.grade || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</p>
      <p>Ø§Ù„Ø³Ø¹Ø±: ${l.price} Ø¬.Ù…</p>

      <input disabled placeholder="Ø§Ù„ÙƒÙˆØ¯ Ø³ÙŠØªÙˆÙ„Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§">

      <button class="btn btn-primary" onclick="addCode('${l.col}')">
        ğŸ² ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯
      </button>


      <div class="codes-box" id="box-${l.col}">
        <h4>Ø§Ù„Ø£ÙƒÙˆØ§Ø¯:</h4>
      </div>
    `;

    grid.appendChild(card);

    const box = document.getElementById(`box-${l.col}`);

    if(related.length===0){
      box.innerHTML += "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙƒÙˆØ§Ø¯</p>";
    } else {
      related.forEach(c=>{
        box.innerHTML += `
        <div class="code-row">
          <div>ğŸ”‘ ${c.code}</div>
          <button class="btn btn-danger" onclick="deleteCode('${c.id}')">
            Ø­Ø°Ù
          </button>
        </div>
        `;
      });
    }
  });
}

window.addCode = async function(lectureName){

  // ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù…ÙƒÙˆÙ‘Ù† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…
  const code = Math.floor(100000 + Math.random() * 900000).toString();

  // Ø­ÙØ¸Ù‡ ÙÙŠ ÙØ§ÙŠØ±Ø³ØªÙˆØ± (Ø§Ø³Ù… Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© = Ø§Ù„ÙƒÙˆØ¯ Ù†ÙØ³Ù‡)
  await setDoc(doc(db, "codes", code), {
    code: code,
    lectureName: lectureName,
    active: true,
    createdAt: new Date()
  });

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
  await fetchCodes();
  render();

  alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯: " + code);
}


window.deleteCode = async function(id){
  if(!confirm("Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯ØŸ")) return;
  await deleteDoc(doc(db,"codes",id));
  await fetchCodes();
  render();
}

async function init(){
  await fetchLectures();
  await fetchCodes();
  render();
}

init();
</script>
</body>
</html>
